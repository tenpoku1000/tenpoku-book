
## 2.3 コーディングの方針

第2章で作成するコンパイラ全体の開発方針は、以下の通りです。

* POSIX 環境のツールに依存しないことと、エラー処理などを柔軟に記述したい目的で、yacc や lex などの自動生成ツールは利用しない
* 静的ライブラリとして作成することで、アプリに組み込んで動作可能にする
* 記号表(TP_SYMBOL_TABLE 構造体)へのポインタを関数の引数として渡すことで、グローバル変数を可能な限り排除し、動作中に再初期化(リセット)を可能にする
* 上記項目の関連で、メモリ解放は OS に任せるのではなく、コンパイラ自身で解放可能とする
* エラー発生時には、可能な限り abort() や exit() せず、処理を継続可能にする
* メッセージ出力は、可能な限り fprintf() などを直書きするのではなく、専用の関数とマクロを実装して呼び出すようにする。出力先や表示内容を制御するため
* 入力するソースコードが UTF-8 であるか、バリデーション(妥当性確認)する。BOM や NUL 文字が含まれていたら、空白で置き換える。改行は内部で LF に統一する
* 中間生成物(構文木と WebAssembly バイナリ表現)のバリデーションを行う
* テスト設計の方針：
    * テスト駆動開発で語られているような、プログラムの動作を非常に具体的かつ詳細にテストすることはしない。今回は、計算結果を正常値と比較する
    * スナップショット(出力されるバイナリや log など)を取得可能にし、スナップショットを比較することで、ソースコードの修正が以前の正常な動作を変えていないことを確認する

